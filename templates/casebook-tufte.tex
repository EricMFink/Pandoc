%%% casebok.tex
%%% Pandoc template for law school casebook using LaTeX article class
%%% Created by Eric M. Fink (https://github.com/LuckyJimJD/pandoc-templates)
%%% 

\documentclass[letterpaper,11pt,twoside,justified,marginals=raggedright]{tufte-book}

% ============
% = Packages =
% ============

\usepackage{lipsum}
\usepackage{semantic}
\usepackage{pdflscape}
\usepackage{framed}
\usepackage{ifxetex}
\usepackage{mdframed}
\usepackage{titlesec}
\usepackage[]{ccicons}


% ==========
% = Colors =
% ==========

\usepackage{xcolor}

\definecolor{myblack}{HTML}{231F20} 
\definecolor{mybrightred}{HTML}{EC1F27} 
\definecolor{mydarkred}{HTML}{b03a2e} 
\definecolor{mydarkblue}{HTML}{154360}
\definecolor{mylightblue}{HTML}{3498DB} 
\definecolor{lightgrey}{HTML}{DCDCDC}

% =========
% = Fonts =
% =========

\usepackage{fontspec}

\setmainfont[Numbers=OldStyle, Scale = 1.0, Colour=myblack]{Sabon LT}
\setsansfont[Colour=myblack]{Lato}
\setmonofont[Color=myblack]{Cousine}

\newfontface\titlefont{Lato}[Colour=mydarkred]
\newfontface\partfont{Sabon LT}[Colour=mydarkred]
\newfontface\chapterfont{Lato Bold}[Colour=mydarkred]
\newfontface\marginfont{Lato Light}

\setsidenotefont{\rmfamily\scriptsize}
\setmarginnotefont{\sffamily\tiny}
\setcaptionfont{\sffamily\scriptsize}


% =========
% = Tufte =
% =========

\usepackage{amsmath,amssymb}
\usepackage{cleveref}
%\usepackage{lmodern}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother

\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available

\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={$title$},
  pdfauthor={$author$},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs

\setlength{\emergencystretch}{3em} % prevent overfull lines

\newenvironment{widetwocolumn}
{
    \begin{fullwidth}
    \begin{multicols}{2}
}
{
    \end{multicols}
    \end{fullwidth}
}

\newenvironment{tufte-landscape}
{
    \begin{landscape}
    \advance\vsize6cm
    \csname @colroom\endcsname=\vsize
    \textheight=\vsize
    \csname @colht\endcsname=\vsize
}
{
    \end{landscape}
}

% https://tex.stackexchange.com/questions/307745/xelatex-latin-modern-mathbb-and-mathcal
\DeclareMathAlphabet{\mathcal}{OMS}{cmsy}{m}{n}
\let\mathbb\relax % remove the definition by unicode-math
\DeclareMathAlphabet{\mathbb}{U}{msb}{m}{n}

\mathlig{<N>}{\mathbb{N}}

% These are broken by default for an unknown reason. We fix them with matlig:
\mathlig{-}{\minus} % Normally renders as whitespace due to missing character.
\mathlig{|}{\mid} % Normally renders as "j"


% https://tex.stackexchange.com/questions/37561/getting-started-with-minion-pro-xelatex-and-mathspec
\ifxetex
  \newcommand{\ttls}[2][5]{%
    \begingroup\addfontfeatures{LetterSpace=#1}#2\endgroup
  }
  \renewcommand{\allcapsspacing}[1]{\ttls[15]{#1}}
  \renewcommand{\smallcapsspacing}[1]{\ttls[10]{#1}}
  \renewcommand{\allcaps}[1]{\ttls[15]{\MakeTextUppercase{#1}}}
  \renewcommand{\smallcaps}[1]{\smallcapsspacing{\scshape\MakeTextLowercase{#1}}}
  \renewcommand{\textsc}[1]{\smallcapsspacing{\textsmallcaps{#1}}}
\fi
\ifluatex
  \usepackage{selnolig}  % disable illegal ligatures
\fi

% =========
% = Lists =
% =========

\usepackage{enumitem}
\setlistdepth{20}
\renewlist{itemize}{itemize}{20}
\renewlist{enumerate}{enumerate}{20}

%\setcounter{secnumdepth}{-\maxdimen} % remove section numbering

\providecommand{\tightlist}{%
  \setlength{\itemsep}{1em}\setlength{\parskip}{0pt}}

\setlist{nosep}
\setlist{itemindent=2em}
\setlist[1]{itemindent=1em}

\setlength\intextsep{15mm}
  
% ============
% = Headings =
% ============

% \titlespacing*{<command>}{<left>}{<before-sep>}{<after-sep>}
\titlespacing*{\part}{0pt}{0pt}{20pt}
\titlespacing*{\chapter}{0em}{0em}{.5em}
\titlespacing*{\section}{0em}{4em}{1.5em}
\titlespacing*{\subsection}{0em}{2em}{1.5em}
\titlespacing*{\subsubsection}{0em}{2em}{.5em}
\titlespacing*{\paragraph}{0em}{2em}{.5em}
\titlespacing*{\subparagraph}{0em}{2em}{.5em}

% No page break before chapter
% \usepackage{etoolbox}
% \makeatletter
% \patchcmd{\chapter}{\cleardoublepage}{}{}{}
% \makeatother

\titleformat{\part}
  [display]
  {\vspace*{\fill}\partfont\huge\bfseries}
  {{\partname} \thepart}
  {0pt}
  {\vspace{2pt}\Huge\MakeUppercase}
  [\vspace*{\fill}]

\titleformat{\chapter}%
  [block]% shape
  {\begin{fullwidth}\raggedright\chapterfont\Huge}% format applied to label+text
  {\thesection}% label
  {1em}% horizontal separation between label and title body
  {}% before the title body
  [\end{fullwidth}]% after the title body
  
\titleformat{\section}%
  [block]% shape
  {\raggedright\normalfont\huge\sffamily}% format applied to label+text
  {\thesection}% label
  {1em}% horizontal separation between label and title body
  {}% before the title body
  []% after the title body

\titleformat{\subsection}%
  [block]% shape
  {\raggedright\normalfont\LARGE\itshape}% format applied to label+text
  {\thesubsection}% label
  {1em}% horizontal separation between label and title body
  {}% before the title body
  []% after the title body
  
\titleclass{\subsubsection}{straight}
\titleformat{\subsubsection}%
  [block]% shape
  {\raggedright\normalfont\Large\bfseries}% format applied to label+text
  {\thesubsubsection}% label
  {1em}% horizontal separation between label and title body
  {}% before the title body
  []% after the title body
  
\titleclass{\paragraph}{straight}
\titleformat{\paragraph}%
  [block]% shape
  {\raggedright\normalfont\large\bfseries}% format applied to label+text
  {\theparagraph}% label
  {1em}% horizontal separation between label and title body
  {}% before the title body
  []% after the title body
  
\titleclass{\subparagraph}{straight}
\titleformat{\subparagraph}%
  [block]% shape
  {\raggedright\normalfont\normalsize\bfseries}% format applied to label+text
  {\thesubparagraph}% label
  {1em}% horizontal separation between label and title body
  {}% before the title body
  []% after the title body
  

% =========================
% = Cases, Statutes, etc. =
% =========================

\newcommand{\statute}[1]{{\vspace{2em}}\seprule{\vspace{.1em}}{\noindent\Large\bfseries{#1}}}

\newcommand{\frcp}[1]{{\vspace{2em}}\seprule{\vspace{.1em}}{\noindent\Large\bfseries{Fed. R. Civ. P. {#1}}}}

\newcommand{\case}[1]{{\vspace{2em}}\seprule{\vspace{.1em}}{\noindent\LARGE\bfseries{#1}}}

\newcommand{\misc}[1]{{\vspace{2em}}\seprule{\vspace{.1em}}{\noindent\LARGE\bfseries{#1}}}

\newcommand{\casecite}[1]{{\noindent\large{#1}}}

\newcommand{\caseauth}[1]{{\noindent\large{#1}}}

\newcommand{\misccite}[1]{{\noindent\large{#1}}}

\newcommand{\miscauth}[1]{{\noindent\large{#1}}}

\newcommand{\questions}[1]{{\vspace{2em}}\seprule{\vspace{.1em}}{\noindent\Large\itshape{#1}}}


% ==========
% = Tables =
% ========== 

% table with pandoc
$if(tables)$
\usepackage{longtable,booktabs,array}
$if(multirow)$
\usepackage{multirow}
$endif$
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
$endif$

  
% ==========
% = Quotes =
% ==========

\usepackage[font=sffamily,indentfirst=false,leftmargin=0.5em]{quoting}

\renewenvironment{leftbar}[1][\hsize]
{
    \def\FrameCommand
    {
        {\color{mydarkred}\hspace{2em}\vrule width 3pt}
        \hspace{0em}
    }
    \MakeFramed{\hsize#1\advance\hsize-\width\FrameRestore}
}
{\endMakeFramed}  

\newenvironment{myquotation}{\setlength{\parindent}{0em}\vspace{2em}\begin{leftbar}\small\quoting}{\endquoting\vspace{1em}\end{leftbar}\vspace{1em}}

%\renewenvironment{quote}%
%{\begin{leftbar}\begin{quotation}}%
%{\end{quotation}\end{leftbar}}


  
% ==============
% = Separators =
% ==============

%\newcommand{\colorrule}{%
%    \textcolor{mydarkred}{\rule{.5\textwidth}{1pt}} %change red to blue, green black whatever.
%}

\newcommand*{\seprule}{%
  \par
  \begingroup
    \centering
    \raisebox{.2\baselineskip}{%
      \textcolor{mydarkred}{\rule{\linewidth}{2pt}}%
    }%
    \par
  \endgroup
}


% ============
% = Graphics =
% ============

\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother

% =========
% = Title =
% =========

\usepackage{etoolbox}

\makeatletter
\newcommand{\plainsubtitle}{}%     plain-text-only subtitle
\newcommand{\subtitle}[1]{%
  \gdef\@subtitle{#1}%
  \renewcommand{\plainsubtitle}{#1}% use provided plain-text title
  \ifthenelse{\isundefined{\hypersetup}}%
    {}% hyperref is not loaded; do nothing
    {\hypersetup{pdftitle={\plaintitle: \plainsubtitle{}}}}% set the PDF metadata title
}
\renewcommand{\maketitlepage}[0]{%
  \cleardoublepage%
  {%
  \titlefont%
  \begin{fullwidth}%
  \fontsize{18}{20}\selectfont\par\noindent\textcolor{mydarkred}{\allcaps{\thanklessauthor}}%
  \vspace{11.5pc}%
  \fontsize{36}{40}\selectfont\par\noindent\textcolor{mydarkred}{\allcaps{\thanklesstitle}}%
  \vspace{5pc}%
  \fontsize{24}{28}\selectfont\par\noindent\textcolor{mydarkred}{\allcaps{\plainsubtitle}}%
  \vfill%
  \fontsize{14}{16}\selectfont\par\noindent\allcaps{\thanklesspublisher}%
  \end{fullwidth}%
  }
  \thispagestyle{empty}%
  \clearpage%
}
\makeatother

\title{$title$}
$if(subtitle)$
\subtitle{$subtitle$}
$endif$
\author{$author$}
$if(publisher)$
\publisher{$publisher$}
$endif$
\date{}


% =====================
% = Table of Contents =
% =====================

\usepackage{titletoc,tocloft}

\renewcommand\cfttoctitlefont{\Huge\titlefont}
\renewcommand\cftpartfont{\huge\bfseries}
\renewcommand\cftchapfont{\LARGE\bfseries}
\renewcommand\cftsecfont{\Large\itshape}

\renewcommand\cftpartpagefont{\huge}
\renewcommand\cftchappagefont{\LARGE}
\renewcommand\cftsecpagefont{\Large}

\renewcommand\cftpartafterpnum{\vskip1em}
\renewcommand\cftchapafterpnum{\vskip1em}
\renewcommand\cftsecafterpnum{\vskip1em}

\setlength{\cftchapindent}{2em}
\setlength{\cftsecindent}{4em}
\setlength{\cftsubsecindent}{6em}
\setlength{\cftsubsubsecindent}{8em}

% ===================
% = Pandoc citeproc =
% ===================

\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
% For Pandoc 2.8 to 2.11
\newenvironment{cslreferences}%
  {$if(csl-hanging-indent)$\setlength{\parindent}{0pt}%
  \everypar{\setlength{\hangindent}{\cslhangindent}}\ignorespaces$endif$}%
  {\par}
% For pandoc 2.11+ using new --citeproc
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}
\newlength{\cslentryspacingunit} % times entry-spacing
\setlength{\cslentryspacingunit}{\parskip}
\newenvironment{CSLReferences}[2] % #1 hanging-ident, #2 entry spacing
 {% don't indent paragraphs
  \setlength{\parindent}{0pt}
  % turn on hanging indent if param 1 is 1
  \ifodd #1
  \let\oldpar\par
  \def\par{\hangindent=\cslhangindent\oldpar}
  \fi
  % set entry spacing
  \setlength{\parskip}{#2\cslentryspacingunit}
 }%
 {}
\usepackage{calc}
\newcommand{\CSLBlock}[1]{#1\hfill\break}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\csllabelwidth}{#1}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth - \csllabelwidth}{#1}}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}

% =============================================================================
% ============================== BEGIN DOCUMENT =============================== 
% =============================================================================


\begin{document}
\bibliographystyle{plainnat}

\frontmatter
\maketitle

\pagestyle{empty}
\begingroup
\parindent 0pt
\vspace*{\fill}
\ccbyncsa

\footnotesize
This work is licensed under a Creative Commons Attribution 4.0 International License.

Eric M. Fink \\
Elon University School of Law \\
Greensboro, North Carolina \\
\texttt{efink@elon.edu}

\itshape{Version 1.0, March 2022}

\endgroup
\clearpage

\setcounter{tocdepth}{1}
\tableofcontents

\mainmatter

$body$


\end{document}
