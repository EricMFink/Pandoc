%%% casebok.tex
%%% Pandoc template for law school casebook using LaTeX article class
%%% Created by Eric M. Fink (https://github.com/LuckyJimJD/pandoc-templates)
%%% 

\documentclass[letterpaper,11pt,twoside,marginals=raggedright]{tufte-book}

% ============
% = Packages =
% ============

\usepackage{lipsum}
\usepackage{semantic}
\usepackage{pdflscape}
\usepackage{framed}
\usepackage{mdframed}
\usepackage{ifxetex}
\usepackage{mdframed}
\usepackage{titlesec}
\usepackage[]{ccicons}
\usepackage{setspace}
\usepackage{ragged2e}
\usepackage[none]{hyphenat}
\usepackage{etoolbox}
\usepackage{relsize}
\usepackage{fourier}
\usepackage{fontawesome}


% ===================================
% = Use md inside latex environment =
% ===================================

\let\Begin\begin
\let\End\end

% ====================
% = Layout & Spacing =
% ====================

\RaggedRight
\raggedbottom
\frenchspacing

%\setlength{\parindent}{0em}
%\setlength{\parskip}{1em}


% ==========
% = Colors =
% ==========

\usepackage{xcolor}

\definecolor{myblack}{HTML}{231F20} 
\definecolor{mybrightred}{HTML}{EC1F27} 
\definecolor{mydarkred}{HTML}{8C2E24} 
\definecolor{mydarkblue}{HTML}{154360}
\definecolor{mylightblue}{HTML}{3498DB} 
\definecolor{lightgrey}{HTML}{DCDCDC}
\definecolor{mydarkgreen}{HTML}{009f06}

% =========
% = Fonts =
% =========

\usepackage{fontspec}

\setmainfont[Numbers=OldStyle, Scale = 1.0]{Sabon LT}
\setsansfont[]{Lato}
\setmonofont[]{Inconsolata}

\newfontface\titlefont{Lato}[Colour=mydarkred]
\newfontface\partfont{Sabon LT}[Colour=mydarkred]
\newfontface\chapterfont{Lato Bold}[Colour=mydarkred]
\newfontface\sectionfont{Sabon LT Bold}[Colour=mydarkred]
\newfontface\headfont{Lato}[Colour=mydarkred]
\newfontface\marginfont{Lato Light}

\setsidenotefont{\rmfamily\scriptsize}
\setmarginnotefont{\sffamily\scriptsize}
\setcaptionfont{\sffamily\scriptsize}


% =========
% = Tufte =
% =========

\usepackage{amsmath,amssymb}
\usepackage{cleveref}
%\usepackage{lmodern}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother

\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available

\usepackage{bookmark}{\usepackage{hyperref}
\hypersetup{
  colorlinks=true,
  linkcolor=mydarkblue,
  pdftitle={$title$},
  pdfauthor={$author$},
  pdfcreator={LaTeX via pandoc}}
\urlstyle{sf}

\setlength{\emergencystretch}{3em} % prevent overfull lines

\newenvironment{widetwocolumn}
{
    \begin{fullwidth}
    \begin{multicols}{2}
}
{
    \end{multicols}
    \end{fullwidth}
}

\newenvironment{tufte-landscape}
{
    \begin{landscape}
    \advance\vsize6cm
    \csname @colroom\endcsname=\vsize
    \textheight=\vsize
    \csname @colht\endcsname=\vsize
}
{
    \end{landscape}
}

% https://tex.stackexchange.com/questions/307745/xelatex-latin-modern-mathbb-and-mathcal
\DeclareMathAlphabet{\mathcal}{OMS}{cmsy}{m}{n}
\let\mathbb\relax % remove the definition by unicode-math
\DeclareMathAlphabet{\mathbb}{U}{msb}{m}{n}

\mathlig{<N>}{\mathbb{N}}

% These are broken by default for an unknown reason. We fix them with matlig:
\mathlig{-}{\minus} % Normally renders as whitespace due to missing character.
\mathlig{|}{\mid} % Normally renders as "j"


% https://tex.stackexchange.com/questions/37561/getting-started-with-minion-pro-xelatex-and-mathspec
\ifxetex
  \newcommand{\ttls}[2][5]{%
    \begingroup\addfontfeatures{LetterSpace=#1}#2\endgroup
  }
  \renewcommand{\allcapsspacing}[1]{\ttls[15]{#1}}
  \renewcommand{\smallcapsspacing}[1]{\ttls[10]{#1}}
  \renewcommand{\allcaps}[1]{\ttls[15]{\MakeTextUppercase{#1}}}
  \renewcommand{\smallcaps}[1]{\smallcapsspacing{\scshape\MakeTextLowercase{#1}}}
  \renewcommand{\textsc}[1]{\smallcapsspacing{\textsmallcaps{#1}}}
\fi
\ifluatex
  \usepackage{selnolig}  % disable illegal ligatures
\fi

% =========
% = Lists =
% =========

\usepackage{enumitem}
\setlistdepth{20}
%\renewlist{itemize}{itemize}{10}
%\renewlist{enumerate}{enumerate}{10}

%\setcounter{secnumdepth}{-\maxdimen} % remove section numbering

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0em}\setlength{\parskip}{.5em}}

%\setlist{nosep}
\setlist[enumerate]{itemindent=2em}
\setlist[enumerate,1]{itemindent=.5em}

% \setlength\intextsep{15mm}


% ================================
% = Cases, Statutes, Rules, etc. =
% ================================


% Colored textbox for statutes, rules, etc. 

\mdfdefinestyle{lightgrey}{leftmargin=0em,rightmargin=0em,%
innerleftmargin=2em,innerrightmargin=2em,linecolor=lightgrey,backgroundcolor=lightgrey,font=\footnotesize}

\newenvironment{shadebox}
    {\noindent\vspace{2em}\Begin{mdframed}[style=lightgrey]
    }
    { 
    \vspace{1em}\End{mdframed}\vspace{2em}
    }

% Indent for statutes, rules, etc. 

\newenvironment{statute}
    {\noindent\Begin{adjustwidth}{1em}{1em}\small
    }
    { 
    \End{adjustwidth}\vspace{.5em}\halfsep\vspace{1em}
    }


% ============
% = Headings =
% ============

% \titlespacing*{<command>}{<left>}{<before-sep>}{<after-sep>}
\titlespacing*{\part}{0pt}{0pt}{20pt}
\titlespacing*{\chapter}{0em}{0em}{.5em}
\titlespacing*{\section}{0em}{2em}{1.5em}
\titlespacing*{\subsection}{0em}{2em}{1em}
\titlespacing*{\subsubsection}{0em}{1.5em}{.5em}
\titlespacing*{\paragraph}{0em}{1em}{.5em}
\titlespacing*{\subparagraph}{0em}{1em}{.5em}


\titleformat{\part}
  [display]
  {\vspace*{\fill}\partfont\huge\bfseries}
  {{\partname} \thepart}
  {0pt}
  {\vspace{2pt}\Huge\MakeUppercase}
  [\vspace*{\fill}]

\titleformat{\chapter}%
  [block]% shape
  {\begin{fullwidth}\raggedright\chapterfont\Huge}% format applied to label+text
  {\thesection}% label
  {1em}% horizontal separation between label and title body
  {}% before the title body
  [\end{fullwidth}]% after the title body
  
\titleformat{\section}%
  [block]% shape
  {\raggedright\sectionfont\LARGE}% format applied to label+text
  {\thesection}% label
  {1em}% horizontal separation between label and title body
  {}% before the title body
  []% after the title body

\titleformat{\subsection}
  [block]% shape
  {\raggedright\normalfont\Large\itshape}% format applied to label+text
  {\thesubsection}% label
  {1em}% horizontal separation between label and title body
  {}% before the title body
  []% after the title body
  
\titleclass{\subsubsection}{straight}
\titleformat{\subsubsection}%
  [block]% shape
  {\raggedright\headfont\large}% format applied to label+text
  {\thesubsubsection}% label
  {1em}% horizontal separation between label and title body
  {}% before the title body
  []% after the title body
  
% Heading for statutes, rules, etc. 
\titleclass{\paragraph}{straight}
\titleformat{\paragraph}%
  [block]% shape
  {\raggedright\headfont\normalsize}% format applied to label+text
  {\theparagraph}% label
  {1em}% horizontal separation between label and title body
  {}% before the title body
  []% after the title body
  
\titleclass{\subparagraph}{straight}
\titleformat{\subparagraph}%
  [block]% shape
  {\raggedright\normalfont\normalsize\bfseries}% format applied to label+text
  {\thesubparagraph}% label
  {1em}% horizontal separation between label and title body
  {}% before the title body
  []% after the title body

% ==========
% = Tables =
% ========== 

% table with pandoc
$if(tables)$
\usepackage{longtable,booktabs,array}
$if(multirow)$
\usepackage{multirow}
$endif$
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
%\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
$endif$
  
% ==========
% = Quotes =
% ==========

% Relative size for quote/quotation

\renewenvironment{quotation}
               {\list{}{\listparindent 1pc%
                        \itemindent    \listparindent
                        \rightmargin   \leftmargin
                        \parsep        \z@ \@plus\p@}%
                \smaller%
                \item\relax\noindent\ignorespaces}
               {\endlist}
\renewenvironment{quote}
               {\list{}{\rightmargin\leftmargin}%
                \smaller%
                \item\relax}
               {\endlist}


% Blockquotes with Left Bar

\usepackage[indentfirst=false,leftmargin=1em]{quoting}

\renewenvironment{leftbar}[1][\hsize]
{
    \def\FrameCommand
    {
        {\color{mydarkred}\hspace{2em}\vrule width 3pt}
        \hspace{0em}
    }
    \MakeFramed{\hsize#1\advance\hsize-\width\FrameRestore}
}
{\endMakeFramed}  

\newenvironment{blockquote}{\setlength{\parindent}{0em}\vspace{2em}\begin{leftbar}\small\quoting}{\endquoting\vspace{1em}\end{leftbar}\vspace{1em}}

% Epigraph

\newcommand{\openepigraph}[3]{ % This block sets up a command for printing an epigraph with 2 arguments - the quote and the author
\noindent\rmfamily\normalsize
{\itshape{#1}}
\begin{flushright}\noindent{#2}, {\itshape{#3}} \end{flushright}
}
  
% ==============
% = Separators =
% ==============

\newcommand{\halfsep}{%
    \textcolor{mydarkred}{\noindent\hfil\rule{.5\textwidth}{.5pt}\hfil} 
}

\newcommand*{\fullsep}{%
  \par
  \begingroup
    \centering
    \raisebox{.2\baselineskip}{%
      \textcolor{mydarkred}{\rule{\linewidth}{2pt}}%
    }%
    \par
  \endgroup
}


% ============
% = Graphics =
% ============

\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother

% =========
% = Title =
% =========

\usepackage{etoolbox}

\makeatletter
\newcommand{\plainsubtitle}{}%     plain-text-only subtitle
\newcommand{\subtitle}[1]{%
  \gdef\@subtitle{#1}%
  \renewcommand{\plainsubtitle}{#1}% use provided plain-text title
  \ifthenelse{\isundefined{\hypersetup}}%
    {}% hyperref is not loaded; do nothing
    {\hypersetup{pdftitle={\plaintitle: \plainsubtitle{}}}}% set the PDF metadata title
}
\renewcommand{\maketitlepage}[0]{%
  \cleardoublepage%
  {%
  \titlefont%
  \begin{fullwidth}%
  \fontsize{18}{20}\selectfont\par\noindent\textcolor{mydarkred}{\allcaps{\thanklessauthor}}%
  \vspace{11.5pc}%
  \fontsize{36}{40}\selectfont\par\noindent\textcolor{mydarkred}{\allcaps{\thanklesstitle}}%
  \vspace{5pc}%
  \fontsize{20}{24}\selectfont\par\noindent\textcolor{mydarkred}{\allcaps{\plainsubtitle}}%
  \vfill%
  $if(publisher)$
  \fontsize{14}{16}\selectfont\par\noindent\allcaps{\thanklesspublisher}%
  $else$
  \fontsize{14}{16}\selectfont\par\noindent\allcaps{$date$}%
  $endif$
  \end{fullwidth}%
  }
  \thispagestyle{empty}%
  \clearpage%
}
\makeatother

\title{$title$}
$if(subtitle)$
\subtitle{$subtitle$}
$endif$
\author{$author$}
$if(publisher)$
\publisher{$publisher$}
$endif$
\date{}


% =====================
% = Table of Contents =
% =====================

\usepackage{titletoc,tocloft}

\renewcommand\cfttoctitlefont{\Huge\titlefont}
\renewcommand\cftpartfont{\Large\bfseries}
\renewcommand\cftchapfont{\large\bfseries}
\renewcommand\cftsecfont{\normalsize\itshape}

\renewcommand\cftpartpagefont{\Large}
\renewcommand\cftchappagefont{\large}
\renewcommand\cftsecpagefont{\normalsize}

\renewcommand\cftpartafterpnum{\vskip1em}
\renewcommand\cftchapafterpnum{\vskip1em}
\renewcommand\cftsecafterpnum{\vskip1em}

\setlength{\cftchapindent}{2em}
\setlength{\cftsecindent}{4em}
\setlength{\cftsubsecindent}{6em}
\setlength{\cftsubsubsecindent}{8em}


% ===================
% = Pandoc citeproc =
% ===================

% Pandoc citation processing
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}
\newlength{\cslentryspacingunit} % times entry-spacing
\setlength{\cslentryspacingunit}{\parskip}
% for Pandoc 2.8 to 2.10.1
%\newenvironment{cslreferences}%
%  {$if(csl-hanging-indent)$\setlength{\parindent}{0pt}%
%  \everypar{\setlength{\hangindent}{\cslhangindent}}\ignorespaces$endif$}%
%  {\par}
% For Pandoc 2.11+
\newenvironment{CSLReferences}[2] % #1 hanging-ident, #2 entry spacing
 {% don't indent paragraphs
  \setlength{\parindent}{0pt}
  % turn on hanging indent if param 1 is 1
  \ifodd #1
  \let\oldpar\par
  \def\par{\hangindent=\cslhangindent\oldpar}
  \fi
  % set entry spacing
  \setlength{\parskip}{#2\cslentryspacingunit}
 }%
 {}
\usepackage{calc}
\newcommand{\CSLBlock}[1]{#1\hfill\break}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\csllabelwidth}{#1}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth - \csllabelwidth}{#1}\break}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}





% =============================================================================
% ============================== BEGIN DOCUMENT =============================== 
% =============================================================================


\begin{document}

\frontmatter
\maketitle

\clearpage

\pagestyle{empty}
\begingroup
\parindent 0pt
\vspace*{\fill}

\begin{small}
Published in the United States of America by \\
Eric M. Fink \\
Elon University School of Law \\
Greensboro, North Carolina 27408

\vspace{1em}

\end{small}

{\ccbyncsa} 

\begin{small}
This work is licensed under a Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License. \\
\url{https://creativecommons.org/licenses/by-nc-sa/4.0/}

\vspace{1em}

Source code \\
\url{https://github.com/EricMFink/CivProCasebook/}

\itshape{Version 1.0, March 2022}

\end{small}

\endgroup
\clearpage

\setcounter{tocdepth}{1}
\tableofcontents
\cleardoublepage

%----------------------------------------------------------------------------------------
%	EPIGRAPH
%----------------------------------------------------------------------------------------

\topskip0pt
\vspace*{\fill}
\openepigraph{$epigraph$}{\aldine ~$epigraph-author$}{$epigraph-source$}
\vspace*{\fill}

\mainmatter

$body$

\clearpage
\end{document}
