%%% casebok.tex
%%% Pandoc template for law school casebook using LaTeX article class
%%% Created by Eric M. Fink (https://github.com/LuckyJimJD/pandoc-templates)
%%% 

\documentclass[letterpaper,10pt,twoside,marginals=raggedright]{tufte-book}

% ============
% = Packages =
% ============

\usepackage{lipsum}
\usepackage{semantic}
\usepackage{pdflscape}
\usepackage{framed}
\usepackage{mdframed}
\usepackage{ifxetex}
\usepackage{mdframed}
\usepackage{titlesec}
\usepackage[]{ccicons}
\usepackage{setspace}
\usepackage{ragged2e}
\usepackage[none]{hyphenat}
\usepackage{etoolbox}
\usepackage{relsize}
\usepackage{fourier}
\usepackage{fontawesome}


% ===================================
% = Use md inside latex environment =
% ===================================

\let\Begin\begin
\let\End\end

% ====================
% = Layout & Spacing =
% ====================

\RaggedRight
\raggedbottom

\setlength{\parindent}{0em}
\setlength{\RaggedRightParindent}{0em}
\setlength{\parskip}{1em}

\clubpenalty=9996
\widowpenalty=9999
\brokenpenalty=4991
\predisplaypenalty=10000
\postdisplaypenalty=1549
\displaywidowpenalty=1602

% \usepackage[defaultlines=3,all]{nowidow}


% ==========
% = Colors =
% ==========

\usepackage{xcolor}

\definecolor{myblack}{HTML}{231F20} 
\definecolor{mybrightred}{HTML}{EC1F27} 
\definecolor{mydarkred}{HTML}{8C2E24} 
\definecolor{mydarkblue}{HTML}{154360}
\definecolor{mylightblue}{HTML}{3498DB} 
\definecolor{paleblue}{HTML}{e1f0fa}
\definecolor{palepink}{HTML}{fef5f9}
\definecolor{lightgrey}{HTML}{e9e9e9}
\definecolor{mydarkgreen}{HTML}{003a02}

% =========
% = Fonts =
% =========

\usepackage{fontspec}

\setmainfont{Sabon LT}[Numbers=OldStyle, Scale = 1.0]
\setsansfont{Lato}[ %
  Extension=.ttf,
  UprightFont=*-Reg,
  ItalicFont=*-RegIta,
  BoldFont=*-Bol,
  BoldItalicFont=*-BolIta,
  FontFace={xl}{n}{*-Hai},
  FontFace={xl}{it}{*-HaiIta},
  FontFace={l}{n}{*-Lig},
  FontFace={l}{it}{*-LigIta},
  FontFace={k}{n}{*-Bla},
  FontFace={k}{it}{*-BlaIta},
]

\setmonofont[]{Inconsolata}

\DeclareRobustCommand{\ltseries}{\fontseries{l}\selectfont}

\newfontface\titlefont{Lato}[Colour=mydarkred]
\newfontface\partfont{Sabon LT}[Colour=mydarkred]

\setsidenotefont{\rmfamily\scriptsize}
\setcaptionfont{\sffamily\scriptsize}
\setmarginnotefont{\sffamily\ltseries\scriptsize}


% =========
% = Tufte =
% =========

\usepackage{amsmath,amssymb}
\usepackage{cleveref}

\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}


\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available

\usepackage{bookmark}{\usepackage{hyperref}
\hypersetup{
  colorlinks=true,
  linkcolor=mydarkblue,
  citecolor=mydarkblue,
  urlcolor=mydarkgreen,
  pdftitle={$title$},
  pdfauthor={$author$},
  pdfcreator={LaTeX via pandoc}}
\urlstyle{sf}

\setlength{\emergencystretch}{3em} % prevent overfull lines

\newenvironment{widetwocolumn}
{
    \begin{fullwidth}
    \begin{multicols}{2}
}
{
    \end{multicols}
    \end{fullwidth}
}

\newenvironment{tufte-landscape}
{
    \begin{landscape}
    \advance\vsize6cm
    \csname @colroom\endcsname=\vsize
    \textheight=\vsize
    \csname @colht\endcsname=\vsize
}
{
    \end{landscape}
}

% https://tex.stackexchange.com/questions/307745/xelatex-latin-modern-mathbb-and-mathcal
\DeclareMathAlphabet{\mathcal}{OMS}{cmsy}{m}{n}
\let\mathbb\relax % remove the definition by unicode-math
\DeclareMathAlphabet{\mathbb}{U}{msb}{m}{n}

\mathlig{<N>}{\mathbb{N}}

% These are broken by default for an unknown reason. We fix them with matlig:
\mathlig{-}{\minus} % Normally renders as whitespace due to missing character.
\mathlig{|}{\mid} % Normally renders as "j"


% https://tex.stackexchange.com/questions/37561/getting-started-with-minion-pro-xelatex-and-mathspec
\ifxetex
  \newcommand{\ttls}[2][5]{%
    \begingroup\addfontfeatures{LetterSpace=#1}#2\endgroup
  }
  \renewcommand{\allcapsspacing}[1]{\ttls[15]{#1}}
  \renewcommand{\smallcapsspacing}[1]{\ttls[10]{#1}}
  \renewcommand{\allcaps}[1]{\ttls[15]{\MakeTextUppercase{#1}}}
  \renewcommand{\smallcaps}[1]{\smallcapsspacing{\scshape\MakeTextLowercase{#1}}}
  \renewcommand{\textsc}[1]{\smallcapsspacing{\textsmallcaps{#1}}}
\fi
\ifluatex
  \usepackage{selnolig}  % disable illegal ligatures
\fi

% =========
% = Lists =
% =========

\usepackage{enumitem}
\setlistdepth{20}
%\renewlist{itemize}{itemize}{10}
%\renewlist{enumerate}{enumerate}{10}

%\setcounter{secnumdepth}{-\maxdimen} % remove section numbering

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0em}\setlength{\parskip}{.5em}}

%\setlist{nosep}
\setlist[enumerate]{itemindent=2em}
\setlist[enumerate,1]{itemindent=.5em}

% \setlength\intextsep{15mm}


% ================================
% = Cases, Statutes, Rules, etc. =
% ================================


% Colored textbox for statutes, rules, etc. 

\mdfdefinestyle{statute}{leftmargin=0em,rightmargin=0em,innerleftmargin=1.5em,innerrightmargin=2em,innertopmargin=\baselineskip,%
innerbottommargin=\baselineskip,linecolor=lightgrey,backgroundcolor=paleblue,font=\small}

\newenvironment{statute}
    {\vspace{1em}\Begin{mdframed}[style=statute]\sffamily
    }
    {\End{mdframed}\vspace{1em}
    }

\mdfdefinestyle{questions}{leftmargin=0em,rightmargin=0em,innerleftmargin=1.5em,innerrightmargin=2em,innertopmargin=\baselineskip,%
innerbottommargin=\baselineskip,linecolor=lightgrey,backgroundcolor=palepink,font=\small}

\newenvironment{questions}
    {\vspace{1em}\Begin{mdframed}[style=questions]\sffamily
    }
    {\End{mdframed}\vspace{1em}
    }

% Indented block

\newenvironment{indented}
    {\noindent\Begin{adjustwidth}{1em}{1em}\small
    }
    { 
    \End{adjustwidth}\vspace{.5em}\halfsep\vspace{1em}
    }


\newcommand{\case}[3]{ % #1=case title; #2=reporter; #3=court and date
\newpage\fullsep\par\noindent
{\bfseries\Large{#1}} \\ \vspace{.5em}{#2} ({#3})
}


\mdfdefinestyle{summary}{leftmargin=0em,rightmargin=0em,innerleftmargin=1.5em,innerrightmargin=2em,innertopmargin=\baselineskip,%
innerbottommargin=\baselineskip,linecolor=lightgrey,backgroundcolor=lightgrey,font=\small}

\newenvironment{summary}
    {\vspace{1em}\Begin{mdframed}[style=summary]\sffamily
    }
    {\End{mdframed}\vspace{1em}
    }


% ============
% = Headings =
% ============

% \titlespacing*{<command>}{<left>}{<before-sep>}{<after-sep>}
\titlespacing*{\part}{0pt}{0pt}{20pt}
\titlespacing*{\chapter}{0em}{0em}{2em}
\titlespacing*{\section}{0em}{2em}{.5em}
\titlespacing*{\subsection}{0em}{1.5em}{0em}
\titlespacing*{\subsubsection}{0em}{1.5em}{0em}
\titlespacing*{\paragraph}{0em}{0em}{0em}
\titlespacing*{\subparagraph}{0em}{0em}{.5em}

$if(secnum)$
\setcounter{secnumdepth}{$secnum$}
$else$
\setcounter{secnumdepth}{0}
$endif$

\renewcommand\thechapter{\arabic{chapter}}
\renewcommand\thesection{\arabic{section}}


\titleformat{\part}
  [display]
  {\vspace*{\fill}\partfont\huge\bfseries}
  {{\partname} \thepart}
  {0pt}
  {\vspace{2pt}\Huge}
  [\vspace*{\fill}]

\titleformat{\chapter}
  [block]
  {\begin{fullwidth}\raggedright\titlefont\huge}
  {Chapter \thechapter \\ }% label
  {0em}
  {}
  [\end{fullwidth}]
  
\titleformat{\section}%
  [block]
  {\raggedright\titlefont\LARGE}
  {\thesection.~}
  {0em}
  {}
  []

\titleformat{\subsection}
  [block]
  {\raggedright\sffamily\Large}
  {\thesubsection}
  {0.5em}
  {}
  []
  
\titleclass{\subsubsection}{straight}
\titleformat{\subsubsection}%
  [block]
  {\raggedright\sffamily\large\itshape}
  {\thesubsubsection}
  {0.5em}
  {}
  []
  
% Heading for statutes, rules, etc. 
\titleclass{\paragraph}{straight}
\titleformat{\paragraph}
  [block]
  {\raggedright\titlefont\large}
  {\theparagraph}
  {0.5em}
  {}
  []
  
\titleclass{\subparagraph}{straight}
\titleformat{\subparagraph}
  [block]
  {\raggedright\sffamily\normalsize}
  {\thesubparagraph}
  {0.5em}
  {}
  []

% ==========
% = Tables =
% ========== 

% table with pandoc
$if(tables)$
\usepackage{longtable,booktabs,array}
$if(multirow)$
\usepackage{multirow}
$endif$
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
%\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
$endif$
  
% ==========
% = Quotes =
% ==========

% Relative size for quote/quotation

\renewenvironment{quotation}
               {\list{}{\listparindent 1pc%
                        \itemindent    \listparindent
                        \rightmargin   \leftmargin
                        \parsep        \z@ \@plus\p@}%
                \relsize{-1}%
                \item\relax\noindent\ignorespaces}
               {\endlist}
\renewenvironment{quote}
               {\list{}{\rightmargin\leftmargin}%
                \relsize{-1}%
                \item\relax}
               {\endlist}


% Blockquotes with Left Bar

\usepackage[indentfirst=false,leftmargin=1em,rightmargin=0em,vskip=0em]{quoting}

\renewenvironment{leftbar}[1][\hsize]
{
    \def\FrameCommand
    {
        {\color{mydarkred}\hspace{2em}\vrule width 3pt}
        \hspace{0em}
    }
    \MakeFramed{\hsize#1\advance\hsize-\width\FrameRestore}
}
{\endMakeFramed}  

\newenvironment{blockquote}{\setlength{\parindent}{0em}\vspace{0em}\begin{leftbar}\small\quoting}{\endquoting\vspace{1em}\end{leftbar}\vspace{0em}}

% Epigraph

\newcommand{\openepigraph}[3]{ % This block sets up a command for printing an epigraph with 2 arguments - the quote and the author
{\noindent\rmfamily\normalsize
{\itshape{#1}}
\begin{flushright}\noindent\aldine ~{#2}, {\itshape{#3}} \end{flushright}}
}

\newcommand{\chapquote}[3]{ 
{\noindent\sffamily\ltseries\small
{\itshape{#1}} \\ \hspace{2em} --- {#2}, {\itshape{#3}}}
}

  
% ==============
% = Separators =
% ==============

\newcommand{\halfsep}{%
    \textcolor{mydarkred}{\noindent\hfil\rule{.5\textwidth}{.5pt}\hfil} 
}

\newcommand*{\fullsep}{%
    \textcolor{mydarkred}{\noindent\hfil\rule{\textwidth}{.5pt}\hfil} 
}


% ============
% = Graphics =
% ============

\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother

% =========
% = Title =
% =========

\usepackage{etoolbox}

\makeatletter
\newcommand{\plainsubtitle}{}%     plain-text-only subtitle
\newcommand{\subtitle}[1]{%
  \gdef\@subtitle{#1}%
  \renewcommand{\plainsubtitle}{#1}% use provided plain-text title
  \ifthenelse{\isundefined{\hypersetup}}%
    {}% hyperref is not loaded; do nothing
    {\hypersetup{pdftitle={\plaintitle: \plainsubtitle{}}}}% set the PDF metadata title
}
\renewcommand{\maketitlepage}[0]{%
  \cleardoublepage%
  {%
  \titlefont%
  \fontsize{18}{20}\selectfont\par\noindent\textcolor{mydarkred}{\allcaps{\thanklessauthor}}%
  \vspace{11.5pc}%
  \fontsize{36}{40}\selectfont\par\noindent\textcolor{mydarkred}{\allcaps{\thanklesstitle}}\par%
  \vspace{5pc}%
  \fontsize{20}{24}\selectfont\par\noindent\textcolor{mydarkred}{\allcaps{\plainsubtitle}}%
  \vfill%
  $if(publisher)$
  \fontsize{14}{16}\selectfont\par\noindent\allcaps{\thanklesspublisher}%
  $endif$
  \fontsize{12}{14}\selectfont\par\noindent\allcaps{$date$}%
  }
  \thispagestyle{empty}%
  \clearpage%
}
\makeatother

\title{$title$} 
$if(subtitle)$
\subtitle{$subtitle$}
$endif$
\author{$author$}
$if(publisher)$
\publisher{$publisher$}
$endif$
\date{$date$}


% =====================
% = Table of Contents =
% =====================

\usepackage{titletoc,tocloft}

\renewcommand\cfttoctitlefont{\Huge\titlefont}
\renewcommand\cftpartfont{\Large\bfseries}
\renewcommand\cftchapfont{\large\bfseries}
\renewcommand\cftsecfont{\normalsize\itshape}

\renewcommand\cftpartpagefont{\Large}
\renewcommand\cftchappagefont{\large}
\renewcommand\cftsecpagefont{\normalsize}

\renewcommand\cftpartafterpnum{\vskip1em}
\renewcommand\cftchapafterpnum{\vskip1em}
\renewcommand\cftsecafterpnum{\vskip1em}

\setlength{\cftchapindent}{2em}
\setlength{\cftsecindent}{4em}
\setlength{\cftsubsecindent}{6em}
\setlength{\cftsubsubsecindent}{8em}


% ===================
% = Pandoc citeproc =
% ===================

% Pandoc citation processing
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}
\newlength{\cslentryspacingunit} % times entry-spacing
\setlength{\cslentryspacingunit}{\parskip}
% for Pandoc 2.8 to 2.10.1
%\newenvironment{cslreferences}%
%  {$if(csl-hanging-indent)$\setlength{\parindent}{0pt}%
%  \everypar{\setlength{\hangindent}{\cslhangindent}}\ignorespaces$endif$}%
%  {\par}
% For Pandoc 2.11+
\newenvironment{CSLReferences}[2] % #1 hanging-ident, #2 entry spacing
 {% don't indent paragraphs
  \setlength{\parindent}{0pt}
  % turn on hanging indent if param 1 is 1
  \ifodd #1
  \let\oldpar\par
  \def\par{\hangindent=\cslhangindent\oldpar}
  \fi
  % set entry spacing
  \setlength{\parskip}{#2\cslentryspacingunit}
 }%
 {}
\usepackage{calc}
\newcommand{\CSLBlock}[1]{#1\hfill\break}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\csllabelwidth}{#1}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth - \csllabelwidth}{#1}\break}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}





% =============================================================================
% ============================== BEGIN DOCUMENT =============================== 
% =============================================================================


\begin{document}

\frontmatter
\maketitle

\clearpage

\pagestyle{empty}
\begingroup
\parindent 0pt
\vspace*{\fill}

\begin{small}
Published in the United States of America by \\
Eric M. Fink \\
Elon University School of Law \\
Greensboro, North Carolina 27408

\vspace{1em}

\end{small}

$if(cc0)$

{\ccZero} 

\begin{small}
This work is published under a Creative Commons CC0 1.0 Universal (CC0 1.0) Public Domain Dedication. \\
\url{https://creativecommons.org/publicdomain/zero/1.0/}

$else$

{\ccbyncsa} 

\begin{small}
This work is licensed under a Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License. \\
\url{https://creativecommons.org/licenses/by-nc-sa/4.0/}

$endif$

Source code \\
\url{https://github.com/EricMFink/PRcasebook/}

\itshape{Version 1.0, May 2022}

\end{small}

\endgroup
\clearpage

\setcounter{tocdepth}{1}
\tableofcontents
\cleardoublepage

%----------------------------------------------------------------------------------------
%	EPIGRAPH
%----------------------------------------------------------------------------------------
$if(epigraph)$
\topskip0pt
\vspace*{\fill}
\openepigraph{$epigraph$}{$epigraph-author$}{$epigraph-source$}
\vspace*{\fill}
$endif$

\mainmatter

$body$

\clearpage
\end{document}
